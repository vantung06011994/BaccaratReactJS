import { hiddenIdElement, showIdElement } from "utils";

export function StreamRelay(e, t, o) {
    var n = document.getElementById("video"),
        a = n.getContext("2d"),
        i = document.getElementsByClassName("video-container")[0],
        c = new WebSocket(e);
    function s() {
        var e = i.offsetWidth;
        var t = parseInt((e / 16) * 9);
        n.width = e;
        n.height = t;
    }
    this._ws = c;
    c.onopen = function (e) {
        delete window.disconnectStream;
        delete window.errorStream;
        hiddenIdElement("video_stream");
        showIdElement("video");
    };
    c.onmessage = function (e) {
        var t = new Image();

        t.onload = function () {
            a.drawImage(t, 0, 0, n.width, n.height);
            URL.revokeObjectURL(t.src);
        };
        t.src = URL.createObjectURL(e.data.slice(4, e.data.size, "application/jpeg"));
    };

    c.onerror = t;
    c.onclose = o;
    window.onresize = s;
    s();
}
StreamRelay.prototype.close = function () {
    this._ws.close();
};
